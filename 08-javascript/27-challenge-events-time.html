<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>27-Challenge Events Time</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        canvas {
            background-color: #0a0a0a;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 150, 255, 0.3);
        }

        .contenedor-juego {
            position: relative;
            width: 500px;
            height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 3px solid #fff;
        }

        #areaJuego {
            width: 450px;
            height: 550px;
            background: radial-gradient(circle, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%);
            border-radius: 15px;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            display: none;
            margin: 0;
            border: 2px solid #fff;
        }



        #pantallaFin {
            display: none;
        }

        .pantalla {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.9), rgba(78, 205, 196, 0.9));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }

        .pantalla h2, .pantalla p {
            color: #fff;
            margin: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-weight: bold;
        }

        .pantalla button {
            padding: 15px 30px;
            margin-top: 15px;
            border: 3px solid #fff;
            border-radius: 25px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .pantalla button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        #lienzo {
            display: none;
        }

        .estadisticas {
            position: absolute;
            top: 15px;
            right: 15px;
            color: #fff;
            font-size: 18px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            padding: 10px 15px;
            border-radius: 20px;
            z-index: 10;
            border: 2px solid #fff;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        /* Estilo para los elementos del juego */
        .game-element {
            position: absolute;
            transform: translate(-50%, -50%);
            user-select: none;
        }
        
        .nave {
            width: 100px;
            height: 100px;
            object-fit: contain;
            filter: drop-shadow(0 0 10px #ff6b6b);
        }
        
        .asteroide {
            width: 70px;
            height: 70px;
            object-fit: contain;
            filter: drop-shadow(0 0 8px #4ecdc4);
        }
        
        .estrella {
            font-size: 15px;
            color: #fff;
            text-shadow: 0 0 5px #ff6b6b;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .fallback {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fallback svg {
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.3));
        }
    </style>
</head>

<body class="js">
    <nav>
        <a href="index.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                <path fill="#ffffff" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path>
            </svg>
        </a>
    </nav>
    
    <main>
        <header>
            <h1>27 - Challenge Event Time</h1>
            <p>Create time-based interactive challenges.</p>
        </header>

        <section>
            <div class="contenedor-juego">
                <div id="pantallaInicio" class="pantalla">
                    <img src="../images/roci.svg" alt="Rocinante" style="width: 240px; height: 180px; margin-bottom: 15px; filter: brightness(1.2);">
                    <h2>The Expanse</h2>
                    <p>Usa las flechas para moverte</p>
                    <button id="botonInicio">Jugar</button>
                </div>

                <div id="areaJuego"></div>
                <div class="estadisticas" id="puntajeDisplay"></div>

                <div id="pantallaFin" class="pantalla">
                    <h2>Game Over</h2>
                    <p id="puntajeFinal">Puntaje: 0</p>
                    <button id="botonReiniciar">Jugar de nuevo</button>
                    <button id="botonVolverInicio">Inicio</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Audio para la música del juego -->
    <audio id="gameMusic" loop>
        <source src="../images/short-game-music-loop-38898.mp3" type="audio/mpeg">
    </audio>

    <script>
        const areaJuego = document.getElementById('areaJuego');
        const pantallaInicio = document.getElementById('pantallaInicio');
        const pantallaFin = document.getElementById('pantallaFin');
        const puntajeDisplay = document.getElementById('puntajeDisplay');
        const puntajeFinal = document.getElementById('puntajeFinal');
        const botonInicio = document.getElementById('botonInicio');
        const botonReiniciar = document.getElementById('botonReiniciar');
        const botonVolverInicio = document.getElementById('botonVolverInicio');
        const gameMusic = document.getElementById('gameMusic');

        const estado = {
            nave: null,
            asteroides: [],
            estrellas: [],
            teclasPulsadas: {},
            tiempoAnterior: 0,
            puntaje: 0,
            enJuego: false,
            tiempoDesdeUltimoAsteroide: 0,
            musicaActiva: true
        };

        const config = {
            anchoJuego: 450,
            altoJuego: 550,
            velocidadNave: 6, 
            frecuenciaAsteroides: 600,
            probabilidadAsteroide: 0.03,
            numeroEstrellas: 40
        };

        function crearElementoImagen(ruta, x, y, clase) {
            var elemento = document.createElement('img');
            elemento.src = ruta;
            elemento.style.position = 'absolute';
            elemento.style.left = x + 'px';
            elemento.style.top = y + 'px';
            elemento.style.width = '100px';
            elemento.style.height = '100px';
            elemento.className = clase;
            return elemento;
        }



        function crearElementoEmoji(emoji, x, y, tamaño, clase = '') {
            const elemento = document.createElement('div');
            elemento.className = 'game-element ' + clase;
            elemento.textContent = emoji;
            elemento.style.left = x + 'px';
            elemento.style.top = y + 'px';
            elemento.style.fontSize = tamaño + 'px';
            return elemento;
        }

        function crearNave() {
            const nave = {
                x: config.anchoJuego / 2,
                y: config.altoJuego - 120,
                ancho: 100,
                alto: 100,
                velocidad: config.velocidadNave,
                vx: 0,
                elemento: null
            };

            nave.elemento = crearElementoImagen('../images/spaceship.png', nave.x, nave.y, 'nave');
            areaJuego.appendChild(nave.elemento);
            return nave;
        }

        function crearEstrellas() {
            const estrellas = [];
            
            for (let i = 0; i < config.numeroEstrellas; i++) {
                const estrella = {
                    x: Math.random() * config.anchoJuego,
                    y: Math.random() * config.altoJuego,
                    tamaño: Math.random() * 2 + 1,
                    velocidad: Math.random() * 1 + 0.5,
                    elemento: null
                };
                
                estrella.elemento = crearElementoEmoji('✦', estrella.x, estrella.y, 
                                                    estrella.tamaño * 3, 'estrella');
                areaJuego.appendChild(estrella.elemento);
                estrellas.push(estrella);
            }
            
            return estrellas;
        }

        function crearAsteroide() {
            const asteroide = {
                x: Math.random() * (config.anchoJuego - 70),
                y: -70,
                ancho: 70,
                alto: 70,
                velocidad: 2 + Math.random() * 2,
                elemento: null
            };
            
            asteroide.elemento = crearElementoImagen('../images/asteroid.png', asteroide.x, asteroide.y, 'asteroide');
            areaJuego.appendChild(asteroide.elemento);
            
            return asteroide;
        }

        function actualizarNave() {
            const nave = estado.nave;
            
            if (estado.teclasPulsadas['ArrowLeft']) {
                nave.vx = Math.max(nave.vx - 0.5, -nave.velocidad);
            } 
            else if (estado.teclasPulsadas['ArrowRight']) {
                nave.vx = Math.min(nave.vx + 0.5, nave.velocidad);
            }
            else {
                nave.vx *= 0.9;
            }
            
            nave.x += nave.vx;
            nave.x = Math.max(0, Math.min(config.anchoJuego - nave.ancho, nave.x));
            
            nave.elemento.style.left = nave.x + 'px';
            nave.elemento.style.top = nave.y + 'px';
        }

        function actualizarEstrellas() {
            // Mover las estrellas
            for (var i = 0; i < estado.estrellas.length; i++) {
                var estrella = estado.estrellas[i];
                estrella.y += estrella.velocidad;
                
                // Si la estrella sale de la pantalla, aparece arriba
                if (estrella.y > config.altoJuego) {
                    estrella.y = 0;
                    estrella.x = Math.random() * config.anchoJuego;
                }
                
                // Actualizar posición
                estrella.elemento.style.left = estrella.x + 'px';
                estrella.elemento.style.top = estrella.y + 'px';
            }
        }

        function actualizarAsteroides() {
            // Crear nuevo asteroide con cierta probabilidad
            if (Math.random() < 0.03) {
                estado.asteroides.push(crearAsteroide());
            }

            // Mover y eliminar asteroides
            for (var i = 0; i < estado.asteroides.length; i++) {
                var asteroide = estado.asteroides[i];
                asteroide.y += asteroide.velocidad;
                asteroide.elemento.style.top = asteroide.y + 'px';
                
                // Eliminar asteroide si sale de la pantalla
                if (asteroide.y > config.altoJuego) {
                    asteroide.elemento.remove();
                    estado.asteroides.splice(i, 1);
                }
            }
        }

        function hayColision() {
            // Verificar colisión entre la nave y los asteroides
            var nave = estado.nave;
            
            for (var i = 0; i < estado.asteroides.length; i++) {
                var asteroide = estado.asteroides[i];
                
                // Calcular distancia entre la nave y el asteroide
                var dx = Math.abs(nave.x - asteroide.x);
                var dy = Math.abs(nave.y - asteroide.y);
                
                // Si la distancia es menor que el tamaño combinado, hay colisión
                if (dx < (nave.ancho + asteroide.ancho) / 2 && 
                    dy < (nave.alto + asteroide.alto) / 2) {
                    return true;
                }
            }
            return false;
        }

        function actualizarPuntaje(deltaTiempo) {
            estado.puntaje += deltaTiempo * 0.002;
            puntajeDisplay.innerText = `Puntaje: ${Math.floor(estado.puntaje)}`;
        }

        function bucleJuego(timestamp) {
            if (!estado.enJuego) return;
            
            if (estado.tiempoAnterior === 0) {
                estado.tiempoAnterior = timestamp;
            }
            
            const deltaTiempo = timestamp - estado.tiempoAnterior;
            estado.tiempoAnterior = timestamp;
            
            actualizarEstrellas();
            actualizarNave();
            actualizarAsteroides(deltaTiempo);
            actualizarPuntaje(deltaTiempo);

            if (hayColision()) {
                terminarJuego();
                return;
            }

            requestAnimationFrame(bucleJuego);
        }

        function inicializarJuego() {
            areaJuego.innerHTML = '';
            
            estado.asteroides = [];
            estado.puntaje = 0;
            estado.tiempoAnterior = 0;
            estado.tiempoDesdeUltimoAsteroide = 0;
            estado.enJuego = true;
            
            estado.nave = crearNave();
            estado.estrellas = crearEstrellas();
            
            areaJuego.style.display = 'block';
            pantallaInicio.style.display = 'none';
            pantallaFin.style.display = 'none';
        }

        function iniciarJuego() {
            inicializarJuego();
            requestAnimationFrame(bucleJuego);
            
            // Reproducir música del juego si está activa
            if (estado.musicaActiva) {
                gameMusic.volume = 0.3; // Volumen al 30%
                gameMusic.play().catch(e => {
                    console.log('No se pudo reproducir la música automáticamente:', e);
                });
            }
        }

        function terminarJuego() {
            estado.enJuego = false;
            areaJuego.style.display = 'none';
            pantallaFin.style.display = 'flex';
            puntajeFinal.innerText = 'Puntaje: ' + Math.floor(estado.puntaje);
            
            // Pausar música del juego
            gameMusic.pause();
            gameMusic.currentTime = 0;
        }

        document.addEventListener('keydown', e => {
            estado.teclasPulsadas[e.key] = true;
        });

        document.addEventListener('keyup', e => {
            estado.teclasPulsadas[e.key] = false;
        });

        botonInicio.addEventListener('click', iniciarJuego);
        botonReiniciar.addEventListener('click', iniciarJuego);
        botonVolverInicio.addEventListener('click', function() {
            pantallaFin.style.display = 'none';
            pantallaInicio.style.display = 'flex';
            areaJuego.style.display = 'none';
        });


    </script>
</body>
</html>